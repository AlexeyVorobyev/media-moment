# Лабораторная работа №7

**pytesseract** — это Python-обертка для Tesseract OCR, которая предоставляет удобные функции для работы с
распознаванием текста

Метод `pytesseract.image_to_string` из библиотеки `pytesseract` используется для распознавания текста на изображениях.
Этот метод применяет технологии OCR (оптического распознавания символов) для преобразования изображения с текстом в
строку.

#### Сигнатура

```python
pytesseract.image_to_string(image, lang=None, config='', nice=0, output_type=Output.STRING)
```

## Утилита `tesstrain`

`tesstrain` — это утилита для обучения и дообучения языковых моделей OCR (Optical Character Recognition) в Tesseract.
Она используется для создания кастомных языковых моделей, улучшения существующих или адаптации моделей под специфический
шрифт и стиль текста.

---

### Основные функции

- Создание языковых моделей для OCR с использованием Tesseract.
- Дообучение существующих моделей (`finetuning`) для повышения точности.
- Обучение на пользовательских данных с учётом шрифта, формата и особенностей текста.

---

### Процесс обучения TESSERACT:

1. Требуется использование утилиты tesstrain, которую можно скачать
   по [ссылке](https://github.com/tesseract-ocr/tesstrain.git) в виде репозитория.

2. Создаём датасет данных для обучения в папке data/ground-truth

3. Необходимо сопоставить каждому фото файл .gt.txt содержащий информацию о корректных данных

4. Адские танцы с бубном

5. make training MODEL_NAME=custom_eng START_MODEL=eng - команда для дообучения на основе eng модели

6. make training MODEL_NAME=custom - команда для обучения сырой модели

## Вывод по обучению tesseract

Адекватных результатов получить не удалось, хоть и был достигнут некоторый уровень точности по метрике Левенштайна

**Метрика Левенштейна** (или расстояние редактирования) — это мера сходства между двумя строками. Она вычисляет
минимальное количество операций, необходимых для преобразования одной строки в другую.

Cравнение Tesseract и EasyOCR
============================

**1\. API Tesseract**
---------------------

### Основные методы:

* bashКопировать кодtesseract \[image\] \[output\]Распознаёт текст из изображения и сохраняет в файл.

* **C++ API**:

    * Init(): инициализация движка с языковыми данными.

    * SetImage(): загрузка изображения для обработки.

    * GetUTF8Text(): получение распознанного текста.

    * GetHOCRText(level): возвращает текст в формате HTML с координатами.

    * GetComponentImages(): извлечение данных о блоках текста.

* pythonКопировать кодimport pytesseractfrom PIL import Imagetext = pytesseract.image\_to\_string(Image.open("
  image.png"), lang="eng")print(text)

### Возвращаемые значения:

* **Текст (строка)**: результат распознавания.

* **Координаты символов**: image\_to\_boxes() возвращает координаты для каждого символа.

* **Структурированные данные**:

    * image\_to\_data(): возвращает таблицу с текстом, координатами, уровнем уверенности.

**2\. Структура интеллектуальной модели Tesseract**
---------------------------------------------------

* **LSTM (Long Short-Term Memory)**: нейронная сеть для последовательного распознавания текста.

* **Компоненты обработки**:

    1. **Предобработка**: бинаризация, шумоподавление, выравнивание.

    2. **Распознавание**:

        * Опции OEM (OCR Engine Mode): классический алгоритм или LSTM.

    3. **Анализ структуры**: определение блоков текста, строк, слов и символов.

* **Результат**: текст с метаданными (координаты, уверенность).

**3. Обучение Tesseract**
--------------------------

### Шаги:

1. **Подготовка данных**:

    * Тренировочные изображения с разметкой (форматы .box или .lstmf).

2. **Команды для обучения**:

    * tesseract

      lstm.train: подготовка данных для обучения.

    * combine\_tessdata: сборка обучающей модели в .traineddata.

    * lstmtraining: основная команда для обучения LSTM.

3. **Результат**:

    * Сохранение обученной модели в формате .traineddata.

**4\. API EasyOCR**
-------------------

### Основные методы:

* pythonКопировать кодimport easyocrreader = easyocr.Reader(\['en', 'ru'\]) # Языковые модели

* pythonКопировать кодresult = reader.readtext('image.png')print(result)

### Возвращаемые значения:

* pythonКопировать код\[ (\[\[x1, y1\], \[x2, y2\], \[x3, y3\], \[x4, y4\]\], 'text', 0.95), ...\]

    * **bbox**: координаты текста (четырёхугольник).

    * **text**: распознанный текст.

    * **confidence**: уверенность (0–1).

**5\. Структура интеллектуальной модели EasyOCR**
-------------------------------------------------

* **Архитектура CRNN (Convolutional Recurrent Neural Network)**:

    * **CNN**: извлечение признаков из изображения.

    * **LSTM**: обработка последовательностей.

    * **CTC Loss**: функция потерь для распознавания текста.

* **Фреймворк**: PyTorch.

**6\. Обучение EasyOCR**
------------------------

### Шаги:

1. **Подготовка данных**:

    * Датасет изображений текста с аннотациями (bounding boxes + текст).

    * Используются стандартные наборы данных (например, SynthText).

2. **Обучение**:

    * Используется архитектура CRNN.

    * Команды на базе PyTorch для запуска обучения:

        * Настройка модели.

        * Загрузка данных.

        * Оптимизация с использованием CTC Loss.

3. **Результат**:

    * Модель сохраняется в формате .pth (PyTorch).

# Результаты прогонов моделей:

| Название прогона                                   | Полное  | Левенштайн |
|----------------------------------------------------|---------|------------|
| TesseractWithAugmentation.raw.csv                  | 0.0     | 0.092797   |
| TesseractWithPostProcessing.augmented.csv          | 0.00085 | 0.078724   |
| CustomEngProcessedPytesseract.processed.csv        | 0.0     | 0.386014   |
| CustomEngPytesseract.raw.csv                       | 0.0     | 0.151049   |
| TesseractWithPostProcessing.raw.csv                | 0.0     | 0.116853   |
| ClassicEasyOCR.raw.csv                             | 0.02098 | 0.547133   |
| CustomEngPytesseract.processed.csv                 | 0.0     | 0.39007    |
| CustomEngPytesseractWithAugmentation.raw.csv       | 0.0     | 0.151049   |
| CustomPytesseract.raw.csv                          | 0.0     | 0.083776   |
| ClassicPytesseract.raw.csv                         | 0.0     | 0.09007    |
| ClassicEasyOCR.processed.csv                       | 0.04895 | 0.567133   |
| CustomEngPytesseractWithAugmentation.processed.csv | 0.0     | 0.39007    |
